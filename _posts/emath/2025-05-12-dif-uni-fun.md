---
layout: post
title: "Message Authentication Codes and Their Algebraic Elegance"
date: 2025-05-12
math: true
---

## Introduction

While going through my career and research journey, I occasionally encounter a masterful application of something I once believed was purely an intellectual exercise. These moments stop me in my tracks, leaving me in awe and wonder. Today, I want to write about one such occurrence that happened recently. While reading Introduction to Modern Cryptography by Katz and Lindell, I was mesmerized by the beautiful application of abstract algebra in cryptographic constructions.

Before diving into the elegant mathematics behind these secure designs, let’s first introduce the key cryptographic concepts that motivate their formulation.

---

## Message Authentication Codes (MAC)

In cryptography, **MACs** (Message Authentication Codes) are used to ensure:

- **Integrity**: the message has not been altered
- **Authenticity**: the message was truly generated by the sender

A MAC takes a message and a secret key to generate a short tag. This tag is then sent along with the message. Anyone who knows the secret key can verify the tag, but forging a valid tag without the key is nearly impossible.

$$
\text{Tag} = \mathrm{MAC}_k(m)
$$

Where:

- $ m $: the message , $ k $: the secret key *  ,- $ \mathrm{MAC}_k $: the keyed MAC function
 
k is chosen uniformly from the Key-Space, Pr(k) = 1/ |K| for all k in key-space K.


---

## Key Definitions

- **Pseudorandom Function (PRF)**: A function that takes a truly random seed (e.g., a key) and stretches it into a longer string that looks random.

- **p-Difference-Universal Function**: A function $f$ is *p*-difference-universal if, for any distinct inputs $x_1 \neq x_2$ and any difference $d$, the probability that  
  $f(x_1) - f(x_2) = d$  
  is at most $p$. (Key idea: output differences are nearly uniform and unpredictable.)

- **Strongly Secure MAC**: A MAC is strongly secure if it resists forgery even for an attacker that has access to any number of valid $(m, t)$ pairs.

---

## A Strongly Secure MAC Sceme Construction

Let $ h $ be an p-difference-universal function for negligible p, and let $ F $ be a pseudorandom function. Then the following defines a secure MAC for messages $ m \in \mathcal{M}_n $, where $ n $ is the security parameter.


### Step 1 — Key Generation
Given input $1^n$:

- Generate $k_h \in \mathcal{K}_n$ (key for $h$) , $k_F \in \{0,1\}^n$ (key for PRF)
- Output the key pair $k = (k_h, k_F) $

### Step 2 — Tag Generation (Mac)

Given $(k_h, k_F)$ and message $m \in \mathcal{M}_n$, choose a random $r \in \{0,1\}^n$, and compute:
$$
t := \langle r,\; h_{k_h}(m) + F_{k_F}(r) \rangle
$$


### Step 3 — Verification (Vrfy)

Given $(k_h, k_F)$, $m$, and tag $t = \langle r, s \rangle$, output 1 if and only if:
$$
s = h_{k_h}(m) + F_{k_F}(r)
$$

Let $h$ be an p-difference-universal function, and $F$ be a pseudorandom function then it can be proven that the above is a strongly secure MAC scheme.
Now, let's shift our focus to constructing such p-difference-universal $h$.  

> note: There exist multiple methods for constructing such h (and F), but in this post I will shed light to a very elegant method. it uses concepts from a pure math topic, namely Abstract Algebra. first lets define the core structures that will be used in our formulation. The choice is not based on security measures, only on beauty. 


## Finite Fields $\mathbb{F}_p$ 

> at the end of the post, I will provide a list of nested algebraic structures from Abstract Algebra, which form the foundation needed to reach the structure used in our construction.

Definition $\mathbb{F}_p$ :  A field with finitely many elements. it exists **only when** the number of elements is a power of a prime: 
      $$
      |\mathbb{F}| = p^n
      $$
      where $p$ is a prime and $n \geq 1$


#### Theorem: Roots of Polynomials over a Field

Let $f(x)$ be a non-zero polynomial of degree $d$ over a field $\mathbb{F}$ (coefficient of $f(x)$ come from $\mathbb{F}$) Then:

$$
\text{The number of distinct roots of } f(x) \text{ in } \mathbb{F} \leq d
$$

In particular, if $\mathbb{F} = \mathbb{F}_p$ is a finite field with $p$ elements, then:

$$
f(x) \text{ has at most } d \text{ roots in } \mathbb{F}_p
$$

We now shall construct the function we want using the properties of a Finite Field

---
## Representing Variable in $F$

Let $F$ be a finite field, and fix a point $k \in F$. Represent each message $m$ as a polynomial over $F$ (i.e., its coefficients are elements of $F$). 

Fix a constant $\ell$, and define the message space as:
$$
\mathcal{M} = \mathbb{F}^{<\ell}
$$
That is, all vectors of length less than $\ell$ over $\mathbb{F}$.

For any message $m = (m_1, \ldots, m_{\ell'-1})$ where $\ell' < \ell$, append $m_{\ell'} \in \mathbb{F}$ to encode the length.

Define the message polynomial:
$$
m(X) = m_1 X^{\ell'} + m_2 X^{\ell'-1} + \cdots + m_{\ell'} X
$$
(So we have a degree-$\ell'$ polynomial that fully represents the message and its length)

#### Constructing a Difference-Universal Keyed Function

Define the keyed function h:
$$
h : \mathbb{F} \times \mathbb{F}^{<\ell} \to \mathbb{F}
$$

by:
$$
h_k(m) := m(k)
$$

That is, evaluate the message polynomial at the point $k$.



---

## Proof that $ h_k $ above is $\frac{\ell}{|\mathbb{F}|}$ -difference-universal.

Let $m_1 \ne m_2$ be two distinct messages in the set $\mathcal{M} = \mathbb{F}^{<\ell}$, and let $d \in \mathbb{F}$.

Define the polynomial:

$$
p(x) := m_1(x) - m_2(x) - d
$$

Since $m_1 \ne m_2$, this is a **non-zero polynomial** of degree at most $\ell$.

Recall that $h_k(m)$ is defined as evaluating the message polynomial $m$ at point $k$. Then:

$$
\begin{aligned}
h_k(m_1) - h_k(m_2) &= m_1(k) - m_2(k) \\
&= d \\
\Rightarrow\quad m_1(k) - m_2(k) - d &= 0 \\
\Rightarrow\quad p(k) &= 0
\end{aligned}
$$

This means that $k$ is a **root** of the polynomial $p(x)$.

From the **Roots of Polynomials Theorem**, we know that a degree-$\ell$ polynomial has at most $\ell$ roots over $\mathbb{F}$.
Recall that $k \in \mathbb{F}$ is chosen uniformly at random, then:

$$
\Pr[p(k) = 0] \leq \frac{\ell}{|\mathbb{F}|}
$$

But by the definition of $p$, this is the same as:

$$
\Pr[h_k(m_1) - h_k(m_2) = d] \leq \frac{\ell}{|\mathbb{F}|}
$$

---

## Strong Universality: A Stronger Guarantee

In addition to difference-universality, we can construct families of functions with even stronger guarantees known as **strongly universal functions**.


### Definition: Strongly Universal Function

Let $\mathcal{H} = \{ h_k : \mathcal{M} \to \mathcal{T} \}$ be a family of functions indexed by keys $k \in \mathcal{K}$.

We say that $\mathcal{H}$ is a **strongly universal** (or **strongly 2-universal**) function family if, for all distinct inputs $m \ne m' \in \mathcal{M}$ and for all outputs $t, t' \in \mathcal{T}$, we have:

$$
\Pr_{k \in \mathcal{K}}[h_k(m) = t \;\land\; h_k(m') = t'] = \frac{1}{|\mathcal{T}|^2}
$$

### Intuition

A strongly universal function family ensures:

- For any two distinct inputs, the outputs are **completely independent**
- The output of $h_k(m)$ is **uniformly random**
- Knowing $h_k(m)$ reveals **no information** about $h_k(m')$


## A Concrete Construction over $\mathbb{F}_p$

We now define a strongly universal function family over the finite field $\mathbb{F}_p$.

define the key as a pair $k = (a, b)$, where:

- $a \in \mathbb{F}_p^*$ (i.e., $a \ne 0$)
- $b \in \mathbb{F}_p$

The keyed-function $h_k$ is defined as:
$$
h_{a,b}(x) = a \cdot x + b \mod p
$$


### Strong Universality Guarantee

Given $h_k$ defined above, for any distinct $x \ne x' \in \mathbb{F}_p$, and any $y, y' \in \mathbb{F}_p$, we have:

$$
\Pr_{a,b}[h_{a,b}(x) = y \;\text{ and }\; h_{a,b}(x') = y'] = \frac{1}{p^2}
$$

That is, the outputs for any two inputs are uniformly and independently distributed over $\mathbb{F}_p$.  

> Proof is straightforward: solve the system of two equations ($h_{a,b}(x) = y$ and $h_{a,b}(x') = y'$). There is only one $(a, b)$ satisfying both, and since $k$ is chosen uniformly over $\mathbb{F}_p^* \times \mathbb{F}_p$, we get the desired probability.


## In Summary

The power of such formulation was not  clear to me at first (unlike its immediate beauty), but then it dawned on me. 
*2 IS A PRIME!* This construction then allows us to use algebraic reasoning on binary bits {0,1}! 

I’ve always appreciated the elegance of abstract algebra, but I never expected to see it applied in a field as practical as cryptography.

In this moment, I was genuinely astonished. Not just by the beauty, but also by the masterful application of pure maths

By embedding deep algebraic structure into our function designs, we’re able to build systems that are:

- Predictable and analyzable, yet mysterious and impenetrable to attackers
- Backed by formal proofs, not just hope or empirical strength
- Elegant and reusable, with foundations rooted in pure mathematics


*This is a clear example of how pure maths becomes a powerful tool in a master's hands*

---
---

## Algebraic Structures 


- **Group**
  - A set $G$ with a binary operation $\cdot$ satisfying:
    - **Closure**: $a \cdot b \in G$
    - **Associativity**: $(a \cdot b) \cdot c = a \cdot (b \cdot c)$
    - **Identity**: $\exists e \in G$ such that $a \cdot e = a$
    - **Inverses**: $\forall a \in G$, $\exists a^{-1} \in G$ such that $a \cdot a^{-1} = e$
  > **Examples**:
  > - $(\mathbb{Z}, +)$ — identity: $0$, inverse: $-a$
  > - $(\mathbb{R} \setminus \{0\}, \cdot)$ — identity: $1$, inverse: $\frac{1}{a}$


- **Abelian Group**
  - A group where the operation is commutative:
    $$
    a + b = b + a
    $$
  > Real Numbers under addition ($\mathbb{R}$, + ) forms an abelian group.


- **Ring**
  - A set $R$ equipped with two operations: addition $(+)$ and multiplication $(\cdot)$
    - $(R, +)$ is an abelian group
    - Multiplication is associative
    - Distributive laws hold:
      - $a \cdot (b + c) = a \cdot b + a \cdot c$
      - $(a + b) \cdot c = a \cdot c + b \cdot c$
  > **Example**: $(\mathbb{Z}, +, \cdot)$ is a ring (but not a field).


- **Commutative Ring**
  - A ring where multiplication is also commutative:
    $$
    a \cdot b = b \cdot a
    $$


- **Field**
  - A commutative ring $F$ where:
    - $1 \neq 0$ , (Mupltiplicative identity $\neq $ Additive Identity)
    - Every nonzero element has a multiplicative inverse:
      $$
      \forall a \in F \setminus \{0\}, \quad \exists a^{-1} \in F \text{ such that } a \cdot a^{-1} = 1
      $$
    - Both $(F, +)$ and $(F \setminus \{0\}, \cdot)$ are abelian groups
  > **Examples**: $\mathbb{Q}$, $\mathbb{R}$, $\mathbb{F}_p$

## Finite Fields $\mathbb{F}_p$ 

- **Finite Field**  $\mathbb{F}_p$
  - A field with finitely many elements
    - Exists **only when** the number of elements is a power of a prime:
      $$
      |\mathbb{F}| = p^n
      $$
      where $p$ is a prime and $n \geq 1$



---
Bounds are easily testable on python, might do and share github link later
